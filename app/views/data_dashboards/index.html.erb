<%- model_class = DataDashboard -%>
<div class="page-header">
  <h1><%=t '.title', :default => model_class.model_name.human.pluralize.titleize %></h1>
</div>

<%= render :partial => 'searchform' %>

<table class="table table-striped">
  <thead>
    <tr>
      <th><%= model_class.human_attribute_name(:id) %></th>
      <th><%= model_class.human_attribute_name(:calls) %></th>
      <th><%= model_class.human_attribute_name(:clicks) %></th>
      <th><%= model_class.human_attribute_name(:searches) %></th>
      <th><%= model_class.human_attribute_name(:cost) %></th>
      <th><%= model_class.human_attribute_name(:budget) %></th>
      <th><%= model_class.human_attribute_name(:smartphones) %></th>
      <th><%= model_class.human_attribute_name(:tablets) %></th>
      <th><%= model_class.human_attribute_name(:computers) %></th>
      <th>Website Name</th>
      <th><%= model_class.human_attribute_name(:dashboard_id) %></th>
      <th><%= model_class.human_attribute_name(:created_at) %></th>
      <th><%=t '.actions', :default => t("helpers.actions") if current_user.admin.present? %></th>
     
    </tr>
  </thead>
  <tbody>
    <% @data_dashboards.each do |data_dashboard| %>
      <tr>
        
        <% data_id = data_dashboard.dashboard_id %> <!-- find data_dashbord id -->
        <% dashboard_obj = Dashboard.find_by(id: data_id) %><!-- find the Dashboard id or website Name -->
        <%  web_id = dashboard_obj.website_id %> <!-- get the website ID -->
        <%  @user = Website.find_by(id:web_id) %> <!-- Get the website Name/web address -->
        <% unless current_user.admin.blank? %> 
            <% if data_dashboard.dashboard_id == dashboard_obj.id && current_user.id == web_id %>
          <% end %>
              <td><%= link_to data_dashboard.id, data_dashboard_path(data_dashboard) %></td>
              <td><%= data_dashboard.calls %></td>
              <td><%= data_dashboard.clicks %></td>
              <td><%= data_dashboard.searches %></td>
              <td><%= data_dashboard.cost %></td>
              <td><%= data_dashboard.budget %></td>
              <td><%= data_dashboard.smartphones %></td>
              <td><%= data_dashboard.tablets %></td>
              <td><%= data_dashboard.computers %></td>

              <td> <%= @user.name %></td>
              <td><%= data_dashboard.dashboard_id %></td>
              <td><%= data_dashboard.created_at.to_s(:due_date) %></td>
              <td>
                      <%= link_to t('.edit', :default => t("helpers.links.edit")),
                                  edit_data_dashboard_path(data_dashboard), :class => 'btn btn-default btn-xs' if current_user.admin.present? %>
                      <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
                                   data_dashboard_path( data_dashboard),
                                  :method => :delete,
                                  :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                                  :class => 'btn btn-xs btn-danger' if current_user.admin.present? %>
                    </td>
            <% end %>
    
      </tr>
    <% end %>
            <td> Total </td>
            <td><%= "#{@calls}" %></td>
            <td><%= "#{@clicks}" %></td>
            <td><%= "#{@searches}" %></td> 
            <td><%= "#{@cost}" %></td> 
            <td><%= "#{@budget}" %></td> 
            <td><%= "#{@smartphones}" %></td> 
            <td><%= "#{@tablets}" %></td> 
            <td><%= "#{@computers}" %></td> 
  </tbody>
</table>

<%= link_to "Dashboards",
            dashboards_path,
            :class => 'btn btn-warning' %>